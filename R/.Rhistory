# Run on all the dpi in 1 go!
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
# Remove useless objects:
rm(mydata_oocyststemp, DPI)
# Rm the dil column, useless:
Newdata <- Newdata[!names(Newdata) %in% "dil"]
# Rm empty lines (when the mice died, no more counting) :
Newdata <- na.omit(Newdata)
# Merge the 2 dataframe by labels:
names(subsampleDF)[1] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
## Calculate the oocysts in the subsampling:
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
# Calculate the oocysts number in 1 mL:
Oo_Df$abscount <- Oo_Df$raw.count * 10000
# Calculate the oocyst per gram in the processed part of the feces::
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
#Put my dataframe at the good format:
Oo_Df <- Oo_Df[c("mouse.ID", "dpi", "oocysts.per.g", "label")]
# Add the info on the mouse genotype AND on the infection strain:
names(Oo_Df)[1] <- "EH_id"
Oo_Df <- merge(Oo_Df, ExpePlanDF, by = "EH_id")
View(Oo_Df)
Oo_Df <- data.frame(EH_id = Oo_Df$EH_id,
dpi = Oo_Df$dpi,
oocysts.per.g = Oo_Df$oocysts.per.g,
Inf_strain = Oo_Df$Inf_strain,
strain = Oo_Df$strain,
label = Oo_Df$label)
View(Oo_Df)
a <- Oo_Df[Oo_Df$dpi %in% c(3,4),]
a[a$Inf_strain %in% "EI64",]
b <- a[a$Inf_strain %in% "EI64",]
View(b)
length(b)
nrow(b)
c <- Oo_Df[Oo_Df$dpi %in% c(6,7),]
d <- b[b$Inf_strain %in% "Eflab",]
View(b)
View(a)
c <- Oo_Df[Oo_Df$dpi %in% c(6,7),]
c[c$Inf_strain %in% "Eflab",]
d <- c[c$Inf_strain %in% "Eflab",]
View(d)
cbind(c, d)
rbind(c, d)
A <- rbind(c, d)
write.csv(x = A, file = "Mona_samples")
a <- Oo_Df[Oo_Df$dpi %in% c(3,4),]
b <- a[a$Inf_strain %in% "EI64",]
c <- Oo_Df[Oo_Df$dpi %in% c(6,7),]
d <- c[c$Inf_strain %in% "Eflab",]
A <- rbind(c, d)
A <- rbind(b, d)
write.csv(x = A, file = "Mona_samples")
#########################
## Info about experiment:
## 25 mice (LM_0104 was deleted as she died at dpi1)
## 272 mice.days data points
#########################
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
######### I Experiment design:
# Info on the mouse genotype AND on the infection strain:
ExpePlanDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Experiment_Table_raw_Ploen_May2017.csv")
# Print the expe design:
as.data.frame.matrix(table(ExpePlanDF$strain, ExpePlanDF$Inf_strain))
# Load data:
mydata_oocysts <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Oocyst_coding_PloenEx_May2017.csv")
# Remove LM_0104:
mydata_oocysts <- mydata_oocysts[which(mydata_oocysts$X != "LM0104"),]
# Check:
table(is.na(mydata_oocysts[grep("raw.count", names(mydata_oocysts))]))
table(is.na(mydata_oocysts[grep("fec.weight", names(mydata_oocysts))]))
## Error corrected (same amount of fecal weight and oocysts counts)
#######################################################################################!!!!!!!!!!!!!!!!!!!!!!!!!
mydata_weight <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/mouse%20weight.csv")
# Weight of the feces separated for PCR:
subsampleDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Feces_kept_separated_for_PCR.csv")
subsampleDF <- na.omit(subsampleDF)
# Calculate how many animals at start:
summary_table_at_dpi <- function(n){
A = data.frame(mouse_number = ExpePlanDF$EH_id, ExpePlanDF$strain, ExpePlanDF$Inf_strain)
B = data.frame(mouse_number = mydata_weight$mouse_no., mydata_weight[paste0("mouse_weight.g._dpi", n)])
C = merge(A, B, by = "mouse_number")
C = na.omit(C)
table(C$ExpePlanDF.strain, C$ExpePlanDF.Inf_strain)
}
summary_table_at_dpi(11)
######### II Oocysts shedding:
# Initialise Newdata
Newdata <- data.frame(NULL)
# Run on all the dpi in 1 go!
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
# Remove useless objects:
rm(mydata_oocyststemp, DPI)
# Rm the dil column, useless:
Newdata <- Newdata[!names(Newdata) %in% "dil"]
# Rm empty lines (when the mice died, no more counting) :
Newdata <- na.omit(Newdata)
# Merge the 2 dataframe by labels:
names(subsampleDF)[1] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
## Calculate the oocysts in the subsampling:
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
# Calculate the oocysts number in 1 mL:
Oo_Df$abscount <- Oo_Df$raw.count * 10000
# Calculate the oocyst per gram in the processed part of the feces::
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
#Put my dataframe at the good format:
Oo_Df <- Oo_Df[c("mouse.ID", "dpi", "oocysts.per.g", "label")]
# Add the info on the mouse genotype AND on the infection strain:
names(Oo_Df)[1] <- "EH_id"
Oo_Df <- merge(Oo_Df, ExpePlanDF, by = "EH_id")
Oo_Df <- data.frame(EH_id = Oo_Df$EH_id,
dpi = Oo_Df$dpi,
oocysts.per.g = Oo_Df$oocysts.per.g,
Inf_strain = Oo_Df$Inf_strain,
strain = Oo_Df$strain,
label = Oo_Df$label)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
# To keep all plot with the same theme:
theme_alice <- theme_bw() +
theme(plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 20),
legend.text = element_text(size=20),
legend.title = element_blank(),
text = element_text(size = 20))
#### Input needed :
## Oo_Df : a data frame of this format:
# EH_id dpi oocysts.per.g Inf_strain strain
# LM0096   6          0.00      Eflab    PWD
# LM0096   5          0.00      Eflab    PWD
## Weight_Df: a data frame of this format:
# LM_id   dpi Infection_date weight rel.weight mouse_id          name ear sex       born age age_weeks strain line  room.rack cage comment Inf_strain num.inf
# LM0096  dpi0      11_May_17  17.45   98.36528 50035522 PWD158.1.D.2F   0   f 16.04.2016 353        50    PWD  PWD WM1.12/5.1 2164              Eflab       9
# LM0096  dpi1      11_May_17  17.74  100.00000 50035522 PWD158.1.D.2F   0   f 16.04.2016 353        50    PWD  PWD WM1.12/5.1 2164              Eflab       9
# LM0096 dpi10      11_May_17     NA         NA 50035522 PWD158.1.D.2F   0   f 16.04.2016 353        50    PWD  PWD WM1.12/5.1 2164              Eflab       9
###############################
# Input data recent:
# Oo_Df <- read.csv("")
# Weight_Df <- read.csv("")
###############################
## Part 1: how to create a table (cf Emanuel)
## Part 2: how to follow up on the experiment:
# Plot to follow the weight : if < 80% weight, mouse has to be sacrificed
ggplot(data=Alldata,
aes(x=dpi, y=rel.weight, group=LM_id, color=LM_id)) +
geom_line()+
geom_point()+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
geom_hline(yintercept=80, linetype="dashed", color = "red", size=2)+
geom_text(data=subset(Alldata, dpi == "dpi9" | dpi == "dpi11" ),
aes(label=LM_id))+
theme(legend.position="none")
## Part 3: various plots:
## PLOT mice strains:
ggplot(Oo_Df, aes(x=dpi, y=oocysts.per.g, group = strain, col = strain))+
geom_smooth(aes(fill = strain), alpha = 0.2)+
ggtitle("Oocyst count along the experiment, according to the mice genotype, for both Eimeria infection strains",
subtitle = "Loess smoothing + 95% CI")+
scale_x_continuous(breaks = 0:11) +
facet_wrap(~Inf_strain)+
geom_jitter(width=0.1, size=5, pch = 21, color = "black", aes(fill = strain), alpha = 0.78) +
labs(x = "Oocyst per gram", y = "Day post infection") +
scale_y_continuous(labels = scientific) +
theme_alice
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
theme_alice <- theme_bw() +
theme(plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 20),
legend.text = element_text(size=20),
legend.title = element_blank(),
text = element_text(size = 20))
ExpeDF <- read.csv(file = "../data_clean/First_crossing_infection.csv")
ggplot(data=ExpeDF,
aes(x=dpi, y=rel.weight, group=EH_id, color=EH_id)) +
geom_line()+
geom_point()+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
geom_hline(yintercept=80, linetype="dashed", color = "red", size=2)+
geom_text(data=subset(ExpeDF, dpi == "9" | dpi == "11" ),
aes(label=EH_id))+
theme(legend.position="none")
PlotOo <- ggplot(ExpeDF, aes(x=dpi, y=oocysts.per.g, group = strain, col = strain))+
geom_smooth(aes(fill = strain), alpha = 0.2)+
ggtitle("Oocyst count along the experiment, according to the mice genotype, for both Eimeria infection strains",
subtitle = "Loess smoothing + 95% CI")+
scale_x_continuous(breaks = 0:11) +
facet_wrap(~Inf_strain)+
geom_jitter(width=0.1, size=5, pch = 21, color = "black", aes(fill = strain), alpha = 0.78) +
labs(x = "Oocyst per gram", y = "Day post infection") +
scale_y_continuous(labels = scientific) +
theme_alice
ExpeDF
View(ExpeDF)
View(ExpeDF)
#########################
## Info about experiment:
## 25 mice (LM_0104 was deleted as she died at dpi1)
## 272 mice.days data points
#########################
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
######### I Experiment design:
# Info on the mouse genotype AND on the infection strain:
ExpePlanDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Experiment_Table_raw_Ploen_May2017.csv")
# Print the expe design:
as.data.frame.matrix(table(ExpePlanDF$strain, ExpePlanDF$Inf_strain))
# Load data:
mydata_oocysts <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Oocyst_coding_PloenEx_May2017.csv")
# Remove LM_0104:
mydata_oocysts <- mydata_oocysts[which(mydata_oocysts$X != "LM0104"),]
# Check:
table(is.na(mydata_oocysts[grep("raw.count", names(mydata_oocysts))]))
table(is.na(mydata_oocysts[grep("fec.weight", names(mydata_oocysts))]))
## Error corrected (same amount of fecal weight and oocysts counts)
#######################################################################################!!!!!!!!!!!!!!!!!!!!!!!!!
mydata_weight <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/mouse%20weight.csv")
# Weight of the feces separated for PCR:
subsampleDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Feces_kept_separated_for_PCR.csv")
subsampleDF <- na.omit(subsampleDF)
# Calculate how many animals at start:
summary_table_at_dpi <- function(n){
A = data.frame(mouse_number = ExpePlanDF$EH_id, ExpePlanDF$strain, ExpePlanDF$Inf_strain)
B = data.frame(mouse_number = mydata_weight$mouse_no., mydata_weight[paste0("mouse_weight.g._dpi", n)])
C = merge(A, B, by = "mouse_number")
C = na.omit(C)
table(C$ExpePlanDF.strain, C$ExpePlanDF.Inf_strain)
}
summary_table_at_dpi(11)
######### II Oocysts shedding:
# Initialise Newdata
Newdata <- data.frame(NULL)
# Run on all the dpi in 1 go!
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
# Remove useless objects:
rm(mydata_oocyststemp, DPI)
# Rm the dil column, useless:
Newdata <- Newdata[!names(Newdata) %in% "dil"]
# Rm empty lines (when the mice died, no more counting) :
Newdata <- na.omit(Newdata)
# Merge the 2 dataframe by labels:
names(subsampleDF)[1] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
## Calculate the oocysts in the subsampling:
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
# Calculate the oocysts number in 1 mL:
Oo_Df$abscount <- Oo_Df$raw.count * 10000
# Calculate the oocyst per gram in the processed part of the feces::
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
#Put my dataframe at the good format:
Oo_Df <- Oo_Df[c("mouse.ID", "dpi", "oocysts.per.g")]
# Add the info on the mouse genotype AND on the infection strain:
names(Oo_Df)[1] <- "EH_id"
Oo_Df <- merge(Oo_Df, ExpePlanDF, by = "EH_id")
# Visual check-up:
table(Oo_Df$EH_id, Oo_Df$dpi)
######### III. Weight of the mice:
mydata_weight_long <- colnames(mydata_weight) <- gsub("mouse_weight.g.", "weight", colnames(mydata_weight))
mydata_weight_long <- melt(mydata_weight, id=c("mouse_no.", "Infection_date"))  # convert to long format
colnames(mydata_weight_long)[colnames(mydata_weight_long)%in%c("mouse_no.", "variable", "value")] <-
c("LM_id", "dpi", "weight")
mydata_weight_long$dpi <- gsub("weight_", "", mydata_weight_long$dpi)
# Now let's do it relative to the weight of D1:
mydata_weight_relative <- data.frame(LM_id=mydata_weight[,1], mydata_weight[ ,3:14]/mydata_weight[,4]*100)
colnames(mydata_weight_relative) <- gsub("mouse_weight.g.", "rel_w", colnames(mydata_weight_relative))
mydata_weight_relative_long <- melt(mydata_weight_relative, id=c("LM_id"))  # convert to long format
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
ExpePlanDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Experiment_Table_raw_Ploen_May2017.csv")
as.data.frame.matrix(table(ExpePlanDF$strain, ExpePlanDF$Inf_strain))
mydata_oocysts <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Oocyst_coding_PloenEx_May2017.csv")
mydata_oocysts <- mydata_oocysts[which(mydata_oocysts$X != "LM0104"),]
table(is.na(mydata_oocysts[grep("raw.count", names(mydata_oocysts))]))
table(is.na(mydata_oocysts[grep("fec.weight", names(mydata_oocysts))]))
View(mydata_oocysts)
mydata_weight <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/mouse%20weight.csv")
subsampleDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Feces_kept_separated_for_PCR.csv")
subsampleDF <- na.omit(subsampleDF)
summary_table_at_dpi <- function(n){
A = data.frame(mouse_number = ExpePlanDF$EH_id, ExpePlanDF$strain, ExpePlanDF$Inf_strain)
B = data.frame(mouse_number = mydata_weight$mouse_no., mydata_weight[paste0("mouse_weight.g._dpi", n)])
C = merge(A, B, by = "mouse_number")
C = na.omit(C)
table(C$ExpePlanDF.strain, C$ExpePlanDF.Inf_strain)
}
summary_table_at_dpi(11)
Newdata <- data.frame(NULL)
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
rm(mydata_oocyststemp, DPI)
Newdata <- Newdata[!names(Newdata) %in% "dil"]
Newdata <- na.omit(Newdata)
names(subsampleDF)[1] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
Oo_Df$abscount <- Oo_Df$raw.count * 10000
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
View(Oo_Df)
View(Oo_Df)
Oo_Df <- Oo_Df[c("label", "mouse.ID", "dpi", "oocysts.per.g")]
View(Oo_Df)
View(Oo_Df)
names(Oo_Df)[names(Oo_Df%in% "mouse.ID")
#<- "EH_id"
Oo_Df <- merge(Oo_Df, ExpePlanDF, by = "EH_id")
# Visual check-up:
table(Oo_Df$EH_id, Oo_Df$dpi)
######### III. Weight of the mice:
mydata_weight_long <- colnames(mydata_weight) <- gsub("mouse_weight.g.", "weight", colnames(mydata_weight))
mydata_weight_long <- melt(mydata_weight, id=c("mouse_no.", "Infection_date"))  # convert to long format
colnames(mydata_weight_long)[colnames(mydata_weight_long)%in%c("mouse_no.", "variable", "value")] <-
c("LM_id", "dpi", "weight")
mydata_weight_long$dpi <- gsub("weight_", "", mydata_weight_long$dpi)
# Now let's do it relative to the weight of D1:
mydata_weight_relative <- data.frame(LM_id=mydata_weight[,1], mydata_weight[ ,3:14]/mydata_weight[,4]*100)
colnames(mydata_weight_relative) <- gsub("mouse_weight.g.", "rel_w", colnames(mydata_weight_relative))
mydata_weight_relative_long <- melt(mydata_weight_relative, id=c("LM_id"))  # convert to long format
colnames(mydata_weight_relative_long)[colnames(mydata_weight_relative_long)%in%c("variable", "value")] <-
c("dpi", "rel.weight")
mydata_weight_relative_long$dpi <- gsub("weight_", "", mydata_weight_relative_long$dpi)
Alldata <- merge(mydata_weight_long, mydata_weight_relative_long, all=TRUE)
Alldata <- merge(Alldata, ExpePlanDF, by.x="LM_id", by.y="EH_id", all=TRUE)
Alldata$dpi <- reorder(Alldata$dpi, as.numeric(gsub("dpi", "", Alldata$dpi)))
# Rename same mouse labels:
names(Alldata)[1] <- names(Oo_Df)[1]
# Rename correct dpi:
Alldata$dpi <- gsub(pattern = "dpi", replacement = "", x = Alldata$dpi)
Total_Franci <- merge(Alldata, Oo_Df)
write.csv(x = Total_Franci, file = "First_crossing_infection.csv", row.names = F)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
######### I Experiment design:
# Info on the mouse genotype AND on the infection strain:
ExpePlanDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Experiment_Table_raw_Ploen_May2017.csv")
# Print the expe design:
as.data.frame.matrix(table(ExpePlanDF$strain, ExpePlanDF$Inf_strain))
# Load data:
mydata_oocysts <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Oocyst_coding_PloenEx_May2017.csv")
# Remove LM_0104:
mydata_oocysts <- mydata_oocysts[which(mydata_oocysts$X != "LM0104"),]
# Check:
table(is.na(mydata_oocysts[grep("raw.count", names(mydata_oocysts))]))
table(is.na(mydata_oocysts[grep("fec.weight", names(mydata_oocysts))]))
## Error corrected (same amount of fecal weight and oocysts counts)
#######################################################################################!!!!!!!!!!!!!!!!!!!!!!!!!
mydata_weight <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/mouse%20weight.csv")
# Weight of the feces separated for PCR:
subsampleDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Feces_kept_separated_for_PCR.csv")
subsampleDF <- na.omit(subsampleDF)
# Calculate how many animals at start:
summary_table_at_dpi <- function(n){
A = data.frame(mouse_number = ExpePlanDF$EH_id, ExpePlanDF$strain, ExpePlanDF$Inf_strain)
B = data.frame(mouse_number = mydata_weight$mouse_no., mydata_weight[paste0("mouse_weight.g._dpi", n)])
C = merge(A, B, by = "mouse_number")
C = na.omit(C)
table(C$ExpePlanDF.strain, C$ExpePlanDF.Inf_strain)
}
summary_table_at_dpi(11)
######### II Oocysts shedding:
# Initialise Newdata
Newdata <- data.frame(NULL)
# Run on all the dpi in 1 go!
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
# Remove useless objects:
rm(mydata_oocyststemp, DPI)
# Rm the dil column, useless:
Newdata <- Newdata[!names(Newdata) %in% "dil"]
# Rm empty lines (when the mice died, no more counting) :
Newdata <- na.omit(Newdata)
# Merge the 2 dataframe by labels:
names(subsampleDF)[1] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
## Calculate the oocysts in the subsampling:
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
# Calculate the oocysts number in 1 mL:
Oo_Df$abscount <- Oo_Df$raw.count * 10000
# Calculate the oocyst per gram in the processed part of the feces::
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
#Put my dataframe at the good format:
Oo_Df <- Oo_Df[c("label", "mouse.ID", "dpi", "oocysts.per.g")]
names(Oo_Df)[names(Oo_Df%in% "mouse.ID")]
View(Oo_Df)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
theme_alice <- theme_bw() +
theme(plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 20),
legend.text = element_text(size=20),
legend.title = element_blank(),
text = element_text(size = 20))
ExpeDF <- read.csv(file = "https://raw.githubusercontent.com/derele/Eimeria_Lab/master/data_clean/May2017_crossing_infection.csv")
View(ExpeDF)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(scales)
ExpePlanDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Experiment_Table_raw_Ploen_May2017.csv")
as.data.frame.matrix(table(ExpePlanDF$strain, ExpePlanDF$Inf_strain))
mydata_oocysts <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Oocyst_coding_PloenEx_May2017.csv")
mydata_oocysts <- mydata_oocysts[which(mydata_oocysts$X != "LM0104"),]
table(is.na(mydata_oocysts[grep("raw.count", names(mydata_oocysts))]))
table(is.na(mydata_oocysts[grep("fec.weight", names(mydata_oocysts))]))
mydata_weight <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/mouse%20weight.csv")
subsampleDF <- read.csv("https://raw.githubusercontent.com/alicebalard/Eimeria_Lab/master/data_raw/Feces_kept_separated_for_PCR.csv")
subsampleDF <- na.omit(subsampleDF)
summary_table_at_dpi <- function(n){
A = data.frame(mouse_number = ExpePlanDF$EH_id, ExpePlanDF$strain, ExpePlanDF$Inf_strain)
B = data.frame(mouse_number = mydata_weight$mouse_no., mydata_weight[paste0("mouse_weight.g._dpi", n)])
C = merge(A, B, by = "mouse_number")
C = na.omit(C)
table(C$ExpePlanDF.strain, C$ExpePlanDF.Inf_strain)
}
summary_table_at_dpi(11)
Newdata <- data.frame(NULL)
for (DPI in 0:11){
mydata_oocyststemp <- cbind(mydata_oocysts$X,mydata_oocysts[, grep(paste0("dpi.", paste(DPI, "", sep="\\.")), colnames(mydata_oocysts))])
names(mydata_oocyststemp)<- c("mouse.ID","label","fec.weight","dil", "raw.count")
# add column
mydata_oocyststemp$dpi<- DPI
Newdata <- rbind(Newdata, mydata_oocyststemp)
}
rm(mydata_oocyststemp, DPI)
Newdata <- Newdata[!names(Newdata) %in% "dil"]
Newdata <- na.omit(Newdata)
names(subsampleDF)[1] #<- "label"
names(subsampleDF)[names(subsampleDF) %in% "Label"] #<- "label"
names(subsampleDF)[names(subsampleDF) %in% "Label"] <- "label"
Oo_Df <- na.omit(merge(Newdata, subsampleDF, by = "label"))
Oo_Df$Total_feces <- Oo_Df$subsample_g + Oo_Df$fec.weight
Oo_Df$abscount <- Oo_Df$raw.count * 10000
Oo_Df$oocysts.per.g <- Oo_Df$abscount / Oo_Df$fec.weight
View(Oo_Df)
Oo_Df <- Oo_Df[c("label", "mouse.ID", "dpi", "oocysts.per.g")]
names(Oo_Df)[1] #<- "EH_id"
names(Oo_Df)[2] #<- "EH_id"
names(Oo_Df)[names(Oo_Df) %in% "mouse.ID"] #<- "EH_id"
names(Oo_Df)[names(Oo_Df) %in% "mouse.ID"] <- "EH_id"
Oo_Df <- merge(Oo_Df, ExpePlanDF, by = "EH_id")
table(Oo_Df$EH_id, Oo_Df$dpi)
mydata_weight_long <- colnames(mydata_weight) <- gsub("mouse_weight.g.", "weight", colnames(mydata_weight))
mydata_weight_long <- melt(mydata_weight, id=c("mouse_no.", "Infection_date"))  # convert to long format
colnames(mydata_weight_long)[colnames(mydata_weight_long)%in%c("mouse_no.", "variable", "value")] <-
c("LM_id", "dpi", "weight")
mydata_weight_long$dpi <- gsub("weight_", "", mydata_weight_long$dpi)
mydata_weight_relative <- data.frame(LM_id=mydata_weight[,1], mydata_weight[ ,3:14]/mydata_weight[,4]*100)
colnames(mydata_weight_relative) <- gsub("mouse_weight.g.", "rel_w", colnames(mydata_weight_relative))
mydata_weight_relative_long <- melt(mydata_weight_relative, id=c("LM_id"))  # convert to long format
colnames(mydata_weight_relative_long)[colnames(mydata_weight_relative_long)%in%c("variable", "value")] <-
c("dpi", "rel.weight")
mydata_weight_relative_long$dpi <- gsub("weight_", "", mydata_weight_relative_long$dpi)
Alldata <- merge(mydata_weight_long, mydata_weight_relative_long, all=TRUE)
Alldata <- merge(Alldata, ExpePlanDF, by.x="LM_id", by.y="EH_id", all=TRUE)
Alldata$dpi <- reorder(Alldata$dpi, as.numeric(gsub("dpi", "", Alldata$dpi)))
names(Alldata)[1] #<-
names(Oo_Df)[1]
names(Alldata)[names(Alldata) %in% "LM_id"] #<-
names(Oo_Df)[1]
names(Alldata)[names(Alldata) %in% "LM_id"] <- "EH_id"
Alldata$dpi <- gsub(pattern = "dpi", replacement = "", x = Alldata$dpi)
Total_Franci <- merge(Alldata, Oo_Df)
View(Total_Franci)
write.csv(x = Total_Franci, file = "data_clean/May2017_crossing_infection.csv", row.names = F)
write.csv(x = Total_Franci, file = "../data_clean/May2017_crossing_infection.csv", row.names = F)
